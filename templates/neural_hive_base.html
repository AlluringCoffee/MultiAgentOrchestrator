<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Neural Hive: Evolution</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            color: #0ff;
            font-family: 'Courier New', monospace;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .hud-panel {
            pointer-events: auto;
            background: rgba(0, 20, 40, 0.85);
            border: 1px solid #0ff;
            padding: 20px;
            margin: 20px;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }

        #stats-panel {
            position: absolute;
            top: 0;
            left: 0;
        }

        #upgrade-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            max-height: 80vh;
            overflow-y: auto;
        }

        button {
            background: #000;
            color: #0ff;
            border: 1px solid #0ff;
            padding: 10px 20px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
            width: 100%;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 0 5px #0ff;
        }

        button:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 15px #0ff;
        }

        button:disabled {
            border-color: #333;
            color: #333;
            cursor: not-allowed;
            box-shadow: none;
            text-shadow: none;
        }

        h2 {
            margin-top: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid #0ff;
            padding-bottom: 10px;
        }

        .currency {
            font-size: 2em;
            text-shadow: 0 0 10px #0ff;
        }

        #log-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 400px;
            height: 150px;
            overflow-y: auto;
            font-size: 12px;
            opacity: 0.8;
        }

        .log-entry {
            margin-bottom: 4px;
            border-left: 2px solid #0ff;
            padding-left: 8px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <!-- 3D Scene Container -->
    <div id="canvas-container"></div>

    <!-- UI Overlay -->
    <div id="ui-layer">
        <div id="stats-panel" class="hud-panel">
            <h2>Neural Status</h2>
            <div id="knowledge-display" class="currency">0 TB</div>
            <div>Synaptic Density: <span id="density-display">0%</span></div>
            <div>Active Nodes: <span id="nodes-display">1</span></div>
        </div>

        <div id="upgrade-panel" class="hud-panel">
            <h2>Evolution</h2>
            <div id="upgrades-list">
                <!-- Upgrades injected here -->
            </div>
        </div>

        <div id="log-panel" class="hud-panel"></div>
    </div>

    <!-- Core Audio System -->
    <script>
        const AudioSys = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            init() {
                if (this.ctx.state === 'suspended') this.ctx.resume();
            },
            playGlitch() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100 + Math.random() * 500, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, this.ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.15);
            },
            playData() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800 + Math.random() * 200, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.05);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.06);
            }
        };
        document.onclick = () => AudioSys.init();
    </script>

    <!-- Game Logic -->
    <script>
        // --- CONFIGURATION ---
        const GAME_CONFIG = {
            baseClickPower: 1,
            autoClickRate: 0,
            nodeCount: 1,
            maxNodes: 1000,
            bgSpeed: 0.001
        };

        // --- STATE ---
        const GameState = {
            resources: { knowledge: 0 },
            upgrades: {
                'sys_overload': { name: 'Synaptic Overload', cost: 10, count: 0, desc: 'Manually trigger a data spike.', action: 'click' },
                'auto_process': { name: 'Background Process', cost: 50, count: 0, desc: 'Auto-generate 1 TB/s', action: 'auto' },
                'neural_exp': { name: 'Neural Expansion', cost: 100, count: 0, desc: 'Add visible 3D nodes.', action: 'expand' }
            }
        };

        // --- THREE.JS SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000510);
        scene.fog = new THREE.FogExp2(0x000510, 0.002);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 20;
        camera.position.y = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Neural Grid
        const geometry = new THREE.IcosahedronGeometry(0.5, 0);
        const material = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true });
        const nodes = [];

        function addNode() {
            if (nodes.length >= GAME_CONFIG.maxNodes) return;
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(
                (Math.random() - 0.5) * 30,
                (Math.random() - 0.5) * 30,
                (Math.random() - 0.5) * 30
            );
            mesh.userData = { velocity: new THREE.Vector3(Math.random() * 0.02, Math.random() * 0.02, Math.random() * 0.02) };
            scene.add(mesh);
            nodes.push(mesh);
            document.getElementById('nodes-display').innerText = nodes.length;

            // Connection lines logic (simplified for perf)
            if (nodes.length > 1) {
                const lineGeo = new THREE.BufferGeometry().setFromPoints([
                    nodes[nodes.length - 2].position,
                    mesh.position
                ]);
                const lineMat = new THREE.LineBasicMaterial({ color: 0x0044aa, transparent: true, opacity: 0.3 });
                const line = new THREE.Line(lineGeo, lineMat);
                scene.add(line);
            }
        }
        addNode(); // Initial node

        // --- MAIN LOOP ---
        let lastTime = 0;
        function animate(time) {
            requestAnimationFrame(animate);
            const delta = time - lastTime;
            lastTime = time;

            // Rotate nodes
            nodes.forEach(node => {
                node.rotation.x += 0.01;
                node.rotation.y += 0.01;
                node.position.add(node.userData.velocity);
                // Boundary bounce
                if (Math.abs(node.position.x) > 20) node.userData.velocity.x *= -1;
                if (Math.abs(node.position.y) > 20) node.userData.velocity.y *= -1;
                if (Math.abs(node.position.z) > 20) node.userData.velocity.z *= -1;
            });

            // Camera drift
            camera.position.x = Math.sin(time * 0.0001) * 2;
            camera.position.y = Math.cos(time * 0.0001) * 2;
            camera.lookAt(0, 0, 0);

            renderer.render(scene, camera);
        }
        animate(0);

        // --- GAME SYSTEM ---
        function updateUI() {
            document.getElementById('knowledge-display').innerText = Math.floor(GameState.resources.knowledge) + ' TB';
            const density = Math.min(100, (nodes.length / 50) * 100).toFixed(1);
            document.getElementById('density-display').innerText = density + '%';

            // Update Buttons
            const list = document.getElementById('upgrades-list');
            list.innerHTML = '';
            for (const [key, upgrade] of Object.entries(GameState.upgrades)) {
                const btn = document.createElement('button');
                btn.innerHTML = `${upgrade.name} <br><span style="font-size:0.8em; color:#888">${upgrade.desc}</span><br>Cost: ${Math.floor(upgrade.cost)} TB`;
                if (GameState.resources.knowledge < upgrade.cost) btn.disabled = true;
                btn.onclick = () => buyUpgrade(key);
                list.appendChild(btn);
            }
        }

        function log(msg) {
            const ui = document.getElementById('log-panel');
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerText = `> ${msg}`;
            ui.prepend(div);
            if (ui.children.length > 10) ui.lastChild.remove();
        }

        function buyUpgrade(key) {
            const up = GameState.upgrades[key];
            if (GameState.resources.knowledge >= up.cost) {
                GameState.resources.knowledge -= up.cost;
                up.count++;
                up.cost *= 1.5;

                // Execute Effect
                if (up.action === 'click') {
                    // Just unlocks/buffs click (handled in click handler)
                    GAME_CONFIG.baseClickPower *= 1.2;
                } else if (up.action === 'auto') {
                    GAME_CONFIG.autoClickRate += 1;
                } else if (up.action === 'expand') {
                    for (let i = 0; i < 5; i++) addNode();
                    AudioSys.playGlitch();
                }

                log(`System Upgraded: ${up.name} v${up.count}`);
                updateUI();
            }
        }

        // Global Tick
        setInterval(() => {
            if (GAME_CONFIG.autoClickRate > 0) {
                GameState.resources.knowledge += GAME_CONFIG.autoClickRate;
                updateUI();
            }
        }, 1000);

        // --- INPUT HANDLERS ---
        // Clicking anywhere acts as "Synaptic Overload"
        document.addEventListener('mousedown', (e) => {
            if (e.target.tagName !== 'BUTTON') {
                GameState.resources.knowledge += GAME_CONFIG.baseClickPower;
                AudioSys.playData();

                // Visual feedback
                const glitchFX = document.createElement('div');
                glitchFX.style.position = 'absolute';
                glitchFX.style.left = e.clientX + 'px';
                glitchFX.style.top = e.clientY + 'px';
                glitchFX.style.color = '#fff';
                glitchFX.style.pointerEvents = 'none';
                glitchFX.innerText = `+${Math.floor(GAME_CONFIG.baseClickPower)} TB`;
                glitchFX.style.textShadow = '0 0 10px #0ff';
                document.body.appendChild(glitchFX);
                setTimeout(() => glitchFX.remove(), 500);

                updateUI();
            }
        });

        // Initialize UI
        updateUI();
        log("SYSTEM ONLINE. NEURAL LINK ESTABLISHED.");
    </script>
</body>

</html>